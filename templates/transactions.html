@
{% extends "base.html" %}

{% block content %}
<h2>Transactions</h2>

<div class="row mb-3">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">Add / Edit Transaction</div>
            <div class="card-body">
                <form method="POST" action="{{ url_for("transactions") }}">
                    <input type="hidden" name="transaction_id" id="txId">
                    <div class="row g-3">
                        <div class="col-md-2">
                            <input type="date" name="date" id="txDate" class="form-control" required>
                        </div>
                        <div class="col-md-2">
                            <select name="type" id="txType" class="form-select">
                                <option value="expense">Expense</option>
                                <option value="income">Income</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <select name="category" id="txCategory" class="form-select" required>
                                <option value="" disabled selected>Category</option>
                                {% for cat in categories %}
                                <option value="{{ cat.name }}">{{ cat.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-2">
                            <input type="number" step="0.01" name="amount" id="txAmount" class="form-control" placeholder="Amount" required>
                        </div>
                        <div class="col-md-3">
                            <input type="text" name="notes" id="txNotes" class="form-control" placeholder="Notes">
                        </div>
                        <div class="col-md-1">
                            <button type="submit" class="btn btn-success w-100"><i class="fas fa-save"></i></button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="row mb-2">
    <div class="col-md-6">
        <a href="{{ url_for("export_csv") }}" class="btn btn-secondary btn-sm">Export CSV</a>
    </div>
    <div class="col-md-6">
        <form method="GET" class="d-flex">
            <input type="text" name="search" class="form-control form-control-sm me-2" placeholder="Search notes...">
            <button type="submit" class="btn btn-primary btn-sm">Search</button>
        </form>
    </div>
</div>

<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th>Date</th>
                <th>Type</th>
                <th>Category</th>
                <th>Amount</th>
                <th>Notes</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for t in transactions %}
            <tr>
                <td>{{ t.date }}</td>
                <td><span class="badge bg-{{ "danger" if t.type == "expense" else "success" }}">{{ t.type }}</span></td>
                <td>{{ t.category }}</td>
                <td>{{ config.currency_symbol }}{{ t.amount }}</td>
                <td>{{ t.notes }}</td>
                <td>
                    <button class="btn btn-sm btn-warning" onclick="editTx("{{ t._id }}", "{{ t.date }}", "{{ t.type }}", "{{ t.category }}", "{{ t.amount }}", "{{ t.notes }}")"><i class="fas fa-edit"></i></button>
                    <a href="{{ url_for("delete_transaction", id=t._id) }}" class="btn btn-sm btn-danger" onclick="return confirm("Are you sure?")"><i class="fas fa-trash"></i></a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
function editTx(id, date, type, cat, amount, notes) {
    document.getElementById("txId").value = id;
    document.getElementById("txDate").value = date;
    document.getElementById("txType").value = type;
    document.getElementById("txCategory").value = cat;
    document.getElementById("txAmount").value = amount;
    document.getElementById("txNotes").value = notes;
    window.scrollTo(0,0);
}
</script>
{% endblock %}
@
